#!/bin/bash

start=$(date +%s.%N)
# Add permissions: chmod +x script.sh
# Run script: ./script.sh

# Remove the csv files autogenerated from previous run
rm -f "price_evolution.png"
rm -f "random_chosen_network.png"
rm -f "plot_PIN_assortativity.png"
rm -f "plot_PIN_density.png"
rm -f "plot_PIN_spectral_bipartivity.png"
rm -f "plot_PIN_spectral_connected.png"
rm -f csvs/*
rm -f plots/csvs/*

# Compile the Java program
javac -cp atom-1.14.jar src/Main.java src/NoiseAgent.java src/InformedAgent.java

# For loop for our simulations
# Set the number of times to repeat the commands (number of simulations)
n=2
days=100
percentage=10
persons=1000
informed=1

javaPart() {
  local i=$1

  # echo "Start Java Simulation $i..."

  # Run the program and print the output to prices.csv
  # Require 4 arguments: NUMBER_OF_PERSONS, PERCENTAGE_OF_INFORMED, AGGRESSIVITY, DAYS_OF_SIMULATION
  java -classpath "C:\Users\dant\Desktop\Master-Thesis\src;C:\Users\dant\Desktop\Master-Thesis\atom-1.14.jar" Main "$persons" "$informed" "$percentage" "$days" "$i"
  cat "csvs/data$i.csv" | grep "^Price" > "plots/csvs/prices$i.csv"
  sed -i '/noname/d' "plots/csvs/prices$i.csv"
}

pythonComputationPart() {
  echo "Start Python Computation..."

  # Run the Python program for creation
  python plots/monte-carlo/csv_mean_creation.py $n $days
  echo -e "PIN, assortativity and bipartivity csv files was generated. \n"
}

echo "Start Java Simulation..."
for i in $(seq 1 $n); do
    javaPart "$i" &
done
wait

pythonComputationPart

end=$(date +%s.%N)
runtime=$(python -c "print(${end} - ${start})")

echo "Runtime was $runtime seconds."

# For Ubuntu
# java -cp "atom-1.14.jar:." atomSimulation.Main 200 5 10 100
# javac -cp "atom-1.14.jar:." -d . application/src/atomSimulation/Main.java application/src/atomSimulation/InformedAgent.java application/src/atomSimulation/NoiseAgent.java
